<div class="container">
  <div class="action">
    <h4>ä½¿ç”¨AngularæŒ‡ä»¤å®ç°å¯¹åŒå‡»äº‹ä»¶çš„ç›‘æ§ğŸ¦Š</h4>
    <button appDoubleClick mat-button color="warn">ç‚¹å‡»æˆ‘</button>
    <div>
      <h4>ä½¿ç”¨RxjsæŒ‡ä»¤å®ç°å¯¹åŒå‡»å’Œå•å‡»äº‹ä»¶çš„ç›‘æ§ğŸ¦‹</h4>
      <button #button mat-button color="warn" (click)="clickEvent()">åŒå‡»æˆ‘</button>
      <br>
      <mat-chip-list>
        <mat-chip>{{label}}</mat-chip>
      </mat-chip-list>
    </div>
  </div>
  <div class="explanation">
    <markdown ngPreserveWhitespaces>
      ## å°è£…å¥½çš„AngularåŒå‡»äº‹ä»¶è®¢é˜…å®ç°ğŸŒ­
      - åœ¨Angularä¸­æœ‰è®¢é˜…åŒå‡»äº‹ä»¶å¯èƒ½æœ‰å¾ˆå¤šç”¨é€”
      - åœ¨æ­¤ä»…ä»¥æŒ‡ä»¤ä¸­çš„ç”¨æ³•ä¸¾ä¾‹

      ```typescript
      import {{ '{' }} Directive, HostListener } from '@angular/core';

      @Directive({{ '{' }}
      selector: '[appDoubleClick]'
      })
      export class DoubleClickDirective {{ '{' }}
      constructor(){{ '{' }} }

      @HostListener('dblclick') onDoubleClicked(){{ '{' }}
      console.log('double clicked');
      }
      }
      ```

      ## å¼€ç®±çš„rxjsåŒå‡»äº‹ä»¶è®¢é˜…å®ç°ğŸ”

      - å‡è®¾å­˜åœ¨éœ€æ±‚: æ ¹æ®ç”¨æˆ·å•å‡»å’ŒåŒå‡»åˆ†åˆ«è§¦å‘å¼‚æ­¥æ–¹æ³•ï¼Œç®€å•æ¥è¯´
      1. å•å‡»æ—¶è®°å½•è§¦å‘å•å‡»äº‹ä»¶
      2. åŒå‡»æ—¶è®°å½•è§¦å‘åŒå‡»äº‹ä»¶
      3. æ ¹æ®å¯èƒ½çš„éœ€æ±‚åªè®°å½•è§¦å‘åŒå‡»çš„äº‹ä»¶

      ```typescript
      // æ ¹æ®ä»€ä¹ˆæ—¶é—´å†³å®šç”¨æˆ·è¿›è¡Œäº†åŒå‡»æ“ä½œ
      doubleClickDuration = 250;
      // è·å–æ¨¡æ¿ä¸­buttonçš„å¼•ç”¨
      @ViewChild('button', {{ '{' }}read: ElementRef})
      button: ElementRef;
      leftClick$: any;
      label: string;
      clickEvent() {{ '{' }}
      // ä»æŒ‰é’®ç‚¹å‡»äº‹ä»¶ä¸­åˆ›å»ºäº‹ä»¶æµ
      this.leftClick$ = fromEvent(this.button.nativeElement, 'click')
        .pipe(
        // åªé€‰å–å·¦é”®ç‚¹å‡»çš„äº‹ä»¶
          filter((event: any) => event.button === 0)
        );
        // å¯¹äº‹ä»¶è¿›è¡Œdebounceå¤„ç†ä¿è¯åœ¨è§„å®šæ—¶é—´å†…è§¦å‘è¿‡ä¸€æ¬¡
      const debounce$ = this.leftClick$
        .pipe(debounceTime(this.doubleClickDuration));
        // ç¡®ä¿äº‹ä»¶åœ¨ä¸¤æ¬¡ç‚¹å‡»åç»ˆæ­¢
      const clickLimit$ = this.leftClick$
        .pipe(
          bufferCount(2),
        );
      const bufferGate$ = race(debounce$, clickLimit$).pipe(
      // å¯¹äºç³»åˆ—äº‹ä»¶åªä¿ç•™ç¬¬ä¸€ä¸ªäº‹ä»¶ä¹‹åé‡å¯äº‹ä»¶æµ
        first(),
        repeat(),
      )
      // ä¸šåŠ¡é€»è¾‘å®ç°ï¼Œæ ¹æ®ç”¨æˆ·ç‚¹å‡»å†³å®šbufferçš„æ¬¡æ•°(length)
      this.leftClick$.pipe(
        buffer(bufferGate$),
        // Here we map the buffered events into the length of the buffer
        // If the user clicked once, the buffer is 1. If he clicked twice it is 2
        map((clicks: any) => clicks.length),
        filter(length =>  length === 2)
      ).subscribe(clicks => {{ '{' }}
      console.log('double clicked');
      this.label = 'double clicked';
      });
      }
      ```
    </markdown>
  </div>
</div>
